<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ö–∞–∫ —Ç—ã –≤–∏–¥–∏—à—å –º–∏—Ä? ‚Äî –º–∏–Ω–∏‚Äë—Ç–µ—Å—Ç –Ω–∞ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∏–ª–ª—é–∑–∏–∏</title>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2E5CTT9EJ3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-2E5CTT9EJ3');
  </script>
  <style>
    :root{
      --bg:#0b0f17;
      --panel:#111827;
      --panel2:#0f172a;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --line:#24324a;
      --good:#22c55e;
      --bad:#ef4444;
      --accent:#60a5fa;
      --accent2:#a78bfa;
      --warn:#f59e0b;
      --shadow: 0 12px 30px rgba(0,0,0,.45);
      --r:16px;
      --w: 1100px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1000px 600px at 12% 15%, rgba(96,165,250,.18), transparent 55%),
        radial-gradient(900px 500px at 85% 25%, rgba(167,139,250,.16), transparent 55%),
        radial-gradient(700px 500px at 50% 90%, rgba(34,197,94,.10), transparent 55%),
        linear-gradient(180deg, #070a11 0%, #0b1020 60%, #070a11 100%);
      overflow-x:hidden;
    }
    a{color:inherit}
    .wrap{
      width:min(var(--w), 100%);
      max-width:100%;
      margin:0 auto;
      padding: clamp(14px, 2.2vw, 24px) clamp(14px, 2.4vw, 22px) clamp(48px, 6vw, 72px);
    }
    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      background: rgba(10, 14, 24, .55);
      border-bottom: 1px solid rgba(148,163,184,.12);
    }
    .topbar{
      width:min(var(--w), 100%);
      max-width:100%;
      margin:0 auto;
      padding: clamp(10px, 1.8vw, 16px) clamp(14px, 2.4vw, 22px);
      display:flex; align-items:center; justify-content:space-between; gap:14px;
    }
    .brand{
      display:flex; align-items:center; gap:12px; min-width: 260px;
    }
    .logo{
      width:38px; height:38px; border-radius:12px;
      background:
        linear-gradient(135deg, rgba(96,165,250,.95), rgba(167,139,250,.95));
      box-shadow: 0 10px 30px rgba(96,165,250,.25);
      position:relative;
    }
    .logo:before,.logo:after{
      content:"";
      position:absolute; inset:10px;
      border-radius:8px;
      border:2px solid rgba(17,24,39,.55);
    }
    .logo:after{
      inset:14px;
      border-color: rgba(17,24,39,.35);
    }
    .brand h1{
      font-size:14px;
      line-height:1.1;
      margin:0;
      letter-spacing:.2px;
    }
    .brand .sub{font-size:12px; color:var(--muted); margin-top:2px}
    nav{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end;
    }
    .chip{
      border:1px solid rgba(148,163,184,.18);
      background: rgba(17,24,39,.55);
      color: var(--text);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      cursor:pointer;
      transition: transform .08s ease, border-color .2s ease, background .2s ease;
      user-select:none;
    }
    .chip:hover{transform: translateY(-1px); border-color: rgba(96,165,250,.35)}
    .chip[aria-current="page"]{
      background: rgba(96,165,250,.15);
      border-color: rgba(96,165,250,.45);
    }

    .hero{
      margin-top:18px;
      background: linear-gradient(180deg, rgba(17,24,39,.8), rgba(15,23,42,.62));
      border: 1px solid rgba(148,163,184,.14);
      border-radius: calc(var(--r) + 8px);
      padding: 20px;
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .hero:before{
      content:"";
      position:absolute; inset:-40px;
      background:
        radial-gradient(200px 200px at 22% 30%, rgba(96,165,250,.22), transparent 60%),
        radial-gradient(240px 240px at 78% 55%, rgba(167,139,250,.18), transparent 65%),
        repeating-linear-gradient(45deg, rgba(148,163,184,.06), rgba(148,163,184,.06) 2px, transparent 2px, transparent 14px);
      filter: blur(0px);
      opacity:.9;
      pointer-events:none;
    }
    .heroGrid{
      position:relative;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:18px;
      align-items:stretch;
    }
    @media (max-width: 840px){
      .heroGrid{grid-template-columns:1fr}
      .brand{min-width:auto}
    }
    .hero h2{
      margin:0 0 8px;
      font-size: clamp(22px, 3.3vw, 34px);
      letter-spacing:.2px;
      line-height:1.15;
    }
    .hero p{
      margin: 0 0 14px;
      color: rgba(229,231,235,.86);
      line-height:1.45;
    }
    .kbd{
      font-family: var(--mono);
      font-size: 12px;
      padding: 2px 7px;
      border: 1px solid rgba(148,163,184,.25);
      border-bottom-color: rgba(148,163,184,.14);
      background: rgba(2,6,23,.35);
      border-radius: 8px;
      color: rgba(229,231,235,.92);
      white-space:nowrap;
    }
    .ctaRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .btn{
      border:none;
      border-radius: 12px;
      padding: 10px 12px;
      min-height: 42px;
      cursor:pointer;
      font-weight:600;
      background: rgba(96,165,250,.22);
      color: var(--text);
      border:1px solid rgba(96,165,250,.35);
      transition: transform .08s ease, filter .2s ease, background .2s ease;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px); filter: brightness(1.05)}
    .btn.secondary{
      background: rgba(148,163,184,.10);
      border-color: rgba(148,163,184,.18);
      color: rgba(229,231,235,.95);
    }
    .btn.ghost{
      background: transparent;
      border-color: rgba(148,163,184,.22);
      color: rgba(229,231,235,.92);
    }
    .mini{
      font-size:12px;
      color: var(--muted);
      margin-top:10px;
    }
    .stats{
      position:relative;
      background: rgba(2,6,23,.35);
      border: 1px solid rgba(148,163,184,.14);
      border-radius: var(--r);
      padding: 14px;
      box-shadow: 0 10px 28px rgba(0,0,0,.28);
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .stat{
      display:flex; gap:10px; align-items:baseline; justify-content:space-between;
      padding:10px;
      background: rgba(17,24,39,.55);
      border:1px solid rgba(148,163,184,.12);
      border-radius: 12px;
    }
    .stat .k{color: rgba(229,231,235,.9); font-weight:600; font-size:13px}
    .stat .v{font-family: var(--mono); color: rgba(229,231,235,.85); font-size:12px}
    .tag{
      display:inline-flex; gap:6px; align-items:center;
      padding:3px 8px;
      border-radius:999px;
      font-size:11px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(15,23,42,.55);
      color: rgba(229,231,235,.9);
      white-space:nowrap;
    }

    main{margin-top:18px}
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:16px;
    }

    .card{
      background: linear-gradient(180deg, rgba(17,24,39,.82), rgba(15,23,42,.64));
      border: 1px solid rgba(148,163,184,.14);
      border-radius: calc(var(--r) + 6px);
      padding: clamp(12px, 2.2vw, 20px);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .card h3{
      margin:0 0 10px;
      font-size:18px;
    }
    .muted{color: var(--muted)}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}

    .testHeader{
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .badge{
      font-family: var(--mono);
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 10px;
      background: rgba(96,165,250,.16);
      border:1px solid rgba(96,165,250,.28);
      color: rgba(229,231,235,.95);
      white-space:nowrap;
    }
    .question{
      margin: 6px 0 12px;
      color: rgba(229,231,235,.9);
      line-height:1.4;
    }

    .stage{
      width:100%;
      background: rgba(2,6,23,.35);
      border: 1px solid rgba(148,163,184,.14);
      border-radius: var(--r);
      padding: 12px;
      overflow:hidden;
    }
    .stageInner{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      align-items:stretch;
    }
    .svgWrap{
      width:100%;
      display:flex;
      justify-content:center;
      align-items:center;
      padding: 6px;
      border-radius: 14px;
      border:1px dashed rgba(148,163,184,.14);
      background: rgba(15,23,42,.35);
    }
    svg{max-width: 100%; height: auto; display:block}
    .controls{
      display:grid;
      grid-template-columns: minmax(0, 1fr) auto;
      gap:10px;
      align-items:center;
    }
    .answers{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap:8px;
    }
    .answers .btn{min-width:0}
    .toggle{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end;
      color: rgba(229,231,235,.85);
      font-size: 12px;
      user-select:none;
    }
    .toggle input{accent-color: var(--accent)}
    .feedback{
      margin-top:12px;
      padding: 12px;
      border-radius: var(--r);
      border: 1px solid rgba(148,163,184,.14);
      background: rgba(17,24,39,.55);
      display:none;
    }
    .feedback.show{display:block}
    .feedback .line{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      margin-bottom: 8px;
    }
    .pill{
      font-family: var(--mono);
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.35);
      color: rgba(229,231,235,.92);
    }
    .pill.good{border-color: rgba(34,197,94,.35); background: rgba(34,197,94,.10)}
    .pill.bad{border-color: rgba(239,68,68,.35); background: rgba(239,68,68,.10)}
    .explain{color: rgba(229,231,235,.88); line-height:1.45; margin:0}
    .small{font-size:12px}

    .progress{
      display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      margin-top: 6px;
      color: rgba(229,231,235,.85);
      font-size: 12px;
    }
    .bar{
      flex:1;
      min-width: 180px;
      height: 10px;
      border-radius: 999px;
      background: rgba(148,163,184,.12);
      overflow:hidden;
      border: 1px solid rgba(148,163,184,.14);
    }
    .bar > i{
      display:block;
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(96,165,250,.9), rgba(167,139,250,.9));
      border-radius:999px;
      transition: width .25s ease;
    }

    .resultGrid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      align-items:start;
    }
    .resultSummary{
      grid-column: 1 / -1;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
    }
    .scoreRing{
      width: 106px;
      height: 106px;
      border-radius: 50%;
      border: 2px solid rgba(96,165,250,.45);
      background:
        radial-gradient(circle at 30% 25%, rgba(96,165,250,.28), transparent 48%),
        rgba(2,6,23,.5);
      display:grid;
      place-items:center;
      flex-shrink:0;
    }
    .scoreRing span{
      font-family: var(--mono);
      font-size: 24px;
      color: rgba(229,231,235,.94);
    }
    .resultMain{
      min-width: min(100%, 270px);
      flex:1;
    }
    .resultMain p{
      margin:0;
      color: rgba(229,231,235,.88);
      line-height:1.5;
    }
    .resultList{
      margin:0;
      padding:0;
      list-style:none;
      display:grid;
      gap:8px;
    }
    .resultLine{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      padding:8px 10px;
      border-radius: 10px;
      border:1px solid rgba(148,163,184,.14);
      background: rgba(17,24,39,.42);
    }
    .resultLine span{
      min-width: 0;
    }
    .resultLine b{
      font-family: var(--mono);
      white-space:nowrap;
      color: rgba(229,231,235,.94);
      font-size: 12px;
      font-weight:600;
    }
    .resultHint{
      margin-top:10px;
      font-size:12px;
      color: var(--muted);
    }
    .reportBox{
      margin-top: 12px;
      white-space: pre-wrap;
      word-break: break-word;
      font-family: var(--mono);
      font-size:12px;
      color: rgba(229,231,235,.88);
      background: rgba(2,6,23,.35);
      border:1px solid rgba(148,163,184,.14);
      padding:12px;
      border-radius: var(--r);
    }
    @media (max-width: 940px){
      .topbar{
        flex-wrap:wrap;
        justify-content:flex-start;
      }
      nav{
        width:100%;
        justify-content:flex-start;
      }
      .chip{
        min-height: 38px;
      }
      .testHeader > .row{
        width:100%;
      }
      .testHeader > .row .btn{
        flex:1;
      }
      .resultGrid{
        grid-template-columns:1fr;
      }
    }
    @media (max-width: 740px){
      .hero{
        padding: 14px;
      }
      .stats{
        padding: 10px;
      }
      .stat{
        flex-direction:column;
        align-items:flex-start;
      }
      .progress{
        gap:8px;
      }
      .bar{
        min-width: 120px;
      }
      .controls{
        grid-template-columns:1fr;
      }
      .toggle{
        justify-content:flex-start;
      }
      .resultSummary{
        flex-direction:column;
        align-items:flex-start;
      }
    }
    @media (max-width: 560px){
      .ctaRow .btn{
        width:100%;
      }
      .chip{
        flex:1;
      }
      .answers{
        grid-template-columns:1fr;
      }
      .foot{
        font-size: 11px;
      }
      .scoreRing{
        width:92px;
        height:92px;
      }
    }
    .metric{
      background: rgba(2,6,23,.35);
      border: 1px solid rgba(148,163,184,.14);
      border-radius: var(--r);
      padding: 12px;
    }
    .metric h4{margin:0 0 6px; font-size:14px}
    .metric p{margin:0; color: rgba(229,231,235,.86); line-height:1.45}
    .hr{
      height:1px; background: rgba(148,163,184,.12);
      margin: 12px 0;
    }
    .foot{
      margin-top: 16px;
      color: rgba(148,163,184,.85);
      font-size: 12px;
      line-height:1.45;
    }

    /* confetti */
    .confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      display:none;
      z-index: 999;
    }
    .confetti.show{display:block}
    .piece{
      position:absolute;
      width:8px; height:14px;
      border-radius: 2px;
      opacity:.9;
      top:-20px;
      animation: fall 1.7s linear forwards;
    }
    @keyframes fall{
      to{ transform: translateY(110vh) rotate(540deg); opacity:1 }
    }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div class="brand" title="–ú–∏–Ω–∏‚Äë—Å–∞–π—Ç –Ω–∞ HTML/CSS/JS –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>–ö–∞–∫ —Ç—ã –≤–∏–¥–∏—à—å –º–∏—Ä?</h1>
          <div class="sub">–º–∏–Ω–∏‚Äë—Ç–µ—Å—Ç: –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∏–ª–ª—é–∑–∏–∏</div>
        </div>
      </div>
      <nav>
        <button class="chip" data-route="home" aria-current="page">–ì–ª–∞–≤–Ω–∞—è</button>
        <button class="chip" data-route="tests">–¢–µ—Å—Ç</button>
        <button class="chip" data-route="results">–†–µ–∑—É–ª—å—Ç–∞—Ç</button>
        <button class="chip" data-route="about">–û –ø—Ä–æ–µ–∫—Ç–µ</button>
      </nav>
    </div>
  </header>

  <div class="wrap">
    <!-- HOME -->
    <section id="view-home" class="view">
      <div class="hero">
        <div class="heroGrid">
          <div>
            <h2>–¢–≤–æ–π –º–æ–∑–≥ ‚Äî —Ö–∏—Ç—Ä—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏</h2>
            <p>
              –ó–¥–µ—Å—å 6 –∫–æ—Ä–æ—Ç–∫–∏—Ö –∏—Å–ø—ã—Ç–∞–Ω–∏–π. –ù–∞ –∫–∞–∂–¥–æ–º —Ç—ã –æ—Ç–≤–µ—á–∞–µ—à—å, —á—Ç–æ –∫–∞–∂–µ—Ç—Å—è –±–æ–ª—å—à–µ/–¥–ª–∏–Ω–Ω–µ–µ/–∫—Ä–∏–≤–µ–µ.
              –ê –ø–æ—Ç–æ–º –º—ã –ø–æ–∫–∞–∂–µ–º –ø—Ä–∞–≤–¥—É –∏ –æ–±—ä—è—Å–Ω–∏–º, –ø–æ—á–µ–º—É —Ç–∞–∫ –≤—ã—à–ª–æ.
            </p>
            <div class="ctaRow">
              <button class="btn" id="startBtn">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</button>
              <button class="btn secondary" id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
              <button class="btn ghost" id="demoBtn" title="–ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ–≥–æ–Ω –±–µ–∑ —á—Ç–µ–Ω–∏—è">–î–µ–º–æ‚Äë—Ä–µ–∂–∏–º</button>
            </div>
            <div class="mini">
              –ü–æ–¥—Å–∫–∞–∑–∫–∞: –¥–ª—è —á–µ—Å—Ç–Ω–æ—Å—Ç–∏ —Å–Ω–∞—á–∞–ª–∞ <span class="kbd">–Ω–µ –≤–∫–ª—é—á–∞–π</span> ¬´–ø–æ–∫–∞–∑–∞—Ç—å –º–µ—Ä–∫–∏¬ª.
              –ü–æ—Ç–æ–º –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–±—è.
            </div>
          </div>
          <div class="stats">
            <div class="stat">
              <div class="k">–í–æ–ø—Ä–æ—Å–æ–≤</div>
              <div class="v"><span id="totalCount">6</span></div>
            </div>
            <div class="stat">
              <div class="k">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
              <div class="v"><span id="progCount">0</span>/<span id="progTotal">6</span></div>
            </div>
            <div class="stat">
              <div class="k">–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å</div>
              <div class="v"><span class="tag">HTML</span> <span class="tag">CSS</span> <span class="tag">JS</span></div>
            </div>
            <div class="stat">
              <div class="k">–°–æ–≤–µ—Ç</div>
              <div class="v">–ª—É—á—à–µ –Ω–∞ –ü–ö/–ø–ª–∞–Ω—à–µ—Ç–µ</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:16px">
        <h3>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h3>
        <p class="muted" style="margin:0">
          –ú—ã –Ω–µ ¬´–ø—Ä–æ–≤–µ—Ä—è–µ–º –∑—Ä–µ–Ω–∏–µ¬ª. –ú—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, –∫–∞–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç (—Å—Ç—Ä–µ–ª–∫–∏, –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞, –æ–∫—Ä—É–∂–µ–Ω–∏–µ)
          –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ –¥–ª–∏–Ω—ã –∏ —Ä–∞–∑–º–µ—Ä–∞.
        </p>
      </div>
    </section>

    <!-- TESTS -->
    <section id="view-tests" class="view" hidden>
      <div class="card">
        <div class="testHeader">
          <div>
            <h3 style="margin:0">–¢–µ—Å—Ç</h3>
            <div class="muted small">–û—Ç–≤–µ—á–∞–π –±—ã—Å—Ç—Ä–æ, –ø–æ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä—è–π –º–µ—Ä–∫–∞–º–∏.</div>
          </div>
          <div class="row">
            <span class="badge" id="qBadge">–í–æ–ø—Ä–æ—Å 1/6</span>
            <button class="btn secondary" id="prevBtn">‚Üê –ù–∞–∑–∞–¥</button>
            <button class="btn" id="nextBtn">–î–∞–ª—å—à–µ ‚Üí</button>
          </div>
        </div>

        <div class="progress">
          <div class="bar" aria-label="–ü—Ä–æ–≥—Ä–µ—Å—Å"><i id="barFill"></i></div>
          <div><span id="answeredCount">0</span> –∏–∑ <span id="answeredTotal">6</span> –æ—Ç–≤–µ—á–µ–Ω–æ</div>
        </div>

        <div class="hr"></div>

        <div id="testHost" class="stage"></div>
      </div>

      <div class="foot">
        –ù–æ—Ä–º–∞–ª—å–Ω–æ –æ—à–∏–±–∞—Ç—å—Å—è: –∏–ª–ª—é–∑–∏–∏ —Ç–∞–∫ –∏ —Ä–∞–±–æ—Ç–∞—é—Ç üôÇ –ï—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞ ¬´–ø–ª—ã–≤—ë—Ç¬ª ‚Äî —ç—Ç–æ —á–∞—Å—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∞.
      </div>
    </section>

    <!-- RESULTS -->
    <section id="view-results" class="view" hidden>
      <div class="card">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
        <p class="muted" style="margin:0 0 10px">
          –¢—É—Ç —Ç–≤–æ–π ¬´–ø—Ä–æ—Ñ–∏–ª—å –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è¬ª –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º —á–∏—Ç–∞–µ–º–æ–º –≤–∏–¥–µ. –ú–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç.
        </p>
        <div class="resultGrid" id="resultGrid"></div>

        <div class="hr"></div>

        <div class="row">
          <button class="btn" id="copyBtn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç</button>
          <button class="btn secondary" id="backToTestsBtn">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç–µ—Å—Ç—É</button>
        </div>

        <div class="reportBox" id="reportOut"></div>

        <div class="foot">
          <b>–í–∞–∂–Ω–æ:</b> —ç—Ç–æ —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –º–∏–Ω–∏‚Äë—Ç–µ—Å—Ç. –û–Ω –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π.
        </div>
      </div>
    </section>

    <!-- ABOUT -->
    <section id="view-about" class="view" hidden>
      <div class="card">
        <h3>–û –ø—Ä–æ–µ–∫—Ç–µ</h3>
        <p class="muted" style="margin:0 0 10px">
          –°–∞–π—Ç –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ ¬´–ø—Ä–æ–¥—É–∫—Ç¬ª –¥–ª—è —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞: –æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–ª–ª—é–∑–∏–∏,
          —Å–æ–±–∏—Ä–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
        </p>

        <div class="metric">
          <h4>–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏</h4>
          <p>
            –ò–ª–ª—é–∑–∏–∏: –ú—é–ª–ª–µ—Ä–∞‚Äë–õ–∞–π–µ—Ä–∞, –ü–æ–Ω—Ü–æ, –≠–±–±–∏–Ω–≥–∞—É–∑–∞, –¶—ë–ª–ª—å–Ω–µ—Ä–∞, –ì–µ—Ä–∏–Ω–≥–∞ –∏ –û–ø–ø–µ–ª—å‚Äë–ö—É–Ω–¥—Ç–∞.
            –í—Å–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã SVG/HTML, –±–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫.
          </p>
        </div>

        <div class="hr"></div>

        <div class="metric">
          <h4>–ö–∞–∫ —É–ª—É—á—à–∏—Ç—å (–µ—Å–ª–∏ –±—É–¥–µ—Ç –≤—Ä–µ–º—è)</h4>
          <p>
            1) –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ä–æ—Å–Ω–∏–∫ (–≤–æ–∑—Ä–∞—Å—Ç/–≥–æ—Ä–æ–¥/–æ–ø—ã—Ç —Ä–∏—Å–æ–≤–∞–Ω–∏—è). 2) –°–¥–µ–ª–∞—Ç—å ¬´–ø–æ–ª–∑—É–Ω–∫–∏¬ª –¥–ª—è —Ç–æ—á–Ω–æ–π –ø–æ–¥–≥–æ–Ω–∫–∏ –¥–ª–∏–Ω—ã.
            3) –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ñ–∞–π–ª. 4) –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë 2‚Äì3 –∏–ª–ª—é–∑–∏–∏ (–∫–∞—Ñ–µ‚Äë–≤–æ–ª–ª, –ü–æ–≥–≥–µ–Ω–¥–æ—Ä—Ñ–∞, –î–µ–ª—å–±—ë—Ñ–∞).
          </p>
        </div>

        <div class="foot">
          –°–¥–µ–ª–∞–Ω–æ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ: –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ, –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.
        </div>
      </div>
    </section>
  </div>

  <div class="confetti" id="confetti"></div>

  <script>
    // ---------- helpers ----------
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => [...root.querySelectorAll(sel)];
    const clamp = (v, a, b) => Math.max(a, Math.min(b, v));

    // ---------- routes ----------
    const views = {
      home: $('#view-home'),
      tests: $('#view-tests'),
      results: $('#view-results'),
      about: $('#view-about')
    };
    const chips = $$('nav .chip');

    function routeTo(name){
      Object.entries(views).forEach(([k, el]) => el.hidden = k !== name);
      chips.forEach(c => c.setAttribute('aria-current', c.dataset.route === name ? 'page' : 'false'));
      if(name === 'results') renderResults();
      if(name === 'tests') renderTest(current);
      localStorage.setItem('route', name);
      window.scrollTo({top:0, behavior:'smooth'});
    }

    // ---------- tests data ----------
    // Correct answers: –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ "–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ" –∏–ª–∏ "–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ/–ø—Ä—è–º—ã–µ".
    const tests = [
      {
        id:'muller-lyer',
        title:'–ò–ª–ª—é–∑–∏—è –ú—é–ª–ª–µ—Ä–∞‚Äë–õ–∞–π–µ—Ä–∞',
        type:'choice',
        badge:'–î–ª–∏–Ω–∞',
        question:'–ö–∞–∫–∞—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è –¥–ª–∏–Ω–Ω–µ–µ?',
        options:[
          {key:'top', label:'–í–µ—Ä—Ö–Ω—è—è'},
          {key:'bottom', label:'–ù–∏–∂–Ω—è—è'},
          {key:'equal', label:'–û–Ω–∏ —Ä–∞–≤–Ω—ã'}
        ],
        correct:'equal',
        explain:`–î–≤–µ –ª–∏–Ω–∏–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π –¥–ª–∏–Ω—ã, –Ω–æ ¬´—Å—Ç—Ä–µ–ª–∫–∏¬ª –Ω–∞ –∫–æ–Ω—Ü–∞—Ö –¥–∞—é—Ç –º–æ–∑–≥—É –ø–æ–¥—Å–∫–∞–∑–∫—É –ø—Ä–æ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—É/—É–≥–ª—ã.
–ò –∏–∑‚Äë–∑–∞ —ç—Ç–æ–≥–æ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ –æ–¥–Ω–∞ –ª–∏–Ω–∏—è –∫–æ—Ä–æ—á–µ, –∞ –¥—Ä—É–≥–∞—è –¥–ª–∏–Ω–Ω–µ–µ.`,
        render: (state) => `
          <div class="stageInner">
            <div class="svgWrap">
              <svg viewBox="0 0 720 260" role="img" aria-label="–ò–ª–ª—é–∑–∏—è –ú—é–ª–ª–µ—Ä–∞‚Äë–õ–∞–π–µ—Ä–∞">
                <defs>
                  <style>
                    .L{stroke: rgba(229,231,235,.92); stroke-width:10; stroke-linecap:round}
                    .A{stroke: rgba(229,231,235,.92); stroke-width:10; stroke-linecap:round}
                    .M{stroke: rgba(96,165,250,.95); stroke-width:4; stroke-linecap:round; opacity:${state.showMeasure?1:0}}
                    .T{fill: rgba(148,163,184,.8); font: 18px ${getComputedStyle(document.documentElement).getPropertyValue('--mono')}
                  </style>
                </defs>

                <!-- top line with inward arrows -->
                <line x1="160" y1="75" x2="560" y2="75" class="L"/>
                <line x1="160" y1="75" x2="210" y2="35" class="A"/>
                <line x1="160" y1="75" x2="210" y2="115" class="A"/>
                <line x1="560" y1="75" x2="510" y2="35" class="A"/>
                <line x1="560" y1="75" x2="510" y2="115" class="A"/>

                <!-- bottom line with outward arrows -->
                <line x1="160" y1="185" x2="560" y2="185" class="L"/>
                <line x1="160" y1="185" x2="110" y2="145" class="A"/>
                <line x1="160" y1="185" x2="110" y2="225" class="A"/>
                <line x1="560" y1="185" x2="610" y2="145" class="A"/>
                <line x1="560" y1="185" x2="610" y2="225" class="A"/>

                <!-- measurement marks -->
                <line x1="160" y1="20" x2="160" y2="240" class="M"/>
                <line x1="560" y1="20" x2="560" y2="240" class="M"/>
                <text x="165" y="38" class="T" opacity="${state.showMeasure?1:0}">–º–µ—Ä–∫–∏</text>
              </svg>
            </div>

            ${controlsHTML(state)}
          </div>
        `
      },

      {
        id:'ponzo',
        title:'–ò–ª–ª—é–∑–∏—è –ü–æ–Ω—Ü–æ',
        type:'choice',
        badge:'–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞',
        question:'–ö–∞–∫–∞—è –ø–ª–∞–Ω–∫–∞ –∫–∞–∂–µ—Ç—Å—è –¥–ª–∏–Ω–Ω–µ–µ?',
        options:[
          {key:'top', label:'–í–µ—Ä—Ö–Ω—è—è'},
          {key:'bottom', label:'–ù–∏–∂–Ω—è—è'},
          {key:'equal', label:'–û–Ω–∏ —Ä–∞–≤–Ω—ã'}
        ],
        correct:'equal',
        explain:`–°—Ö–æ–¥—è—â–∏–µ—Å—è –ª–∏–Ω–∏–∏ –º–æ–∑–≥ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–∞–∫ ¬´—Ä–µ–ª—å—Å—ã¬ª –≤ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–µ.
–¢–æ, —á—Ç–æ –≤—ã—à–µ, –∫–∞–∂–µ—Ç—Å—è –¥–∞–ª—å—à–µ ‚Äî –∞ –∑–Ω–∞—á–∏—Ç ¬´–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å¬ª –±–æ–ª—å—à–µ. –¢–∞–∫ –∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ–±–º–∞–Ω.`,
        render: (state) => `
          <div class="stageInner">
            <div class="svgWrap">
              <svg viewBox="0 0 720 300" role="img" aria-label="–ò–ª–ª—é–∑–∏—è –ü–æ–Ω—Ü–æ">
                <defs>
                  <style>
                    .rail{stroke: rgba(148,163,184,.65); stroke-width:6}
                    .bar{stroke: rgba(229,231,235,.92); stroke-width:16; stroke-linecap:round}
                    .M{stroke: rgba(96,165,250,.95); stroke-width:4; opacity:${state.showMeasure?1:0}}
                    .T{fill: rgba(148,163,184,.8); font: 18px ${getComputedStyle(document.documentElement).getPropertyValue('--mono')}
                  </style>
                </defs>

                <line x1="120" y1="270" x2="330" y2="40" class="rail"/>
                <line x1="600" y1="270" x2="390" y2="40" class="rail"/>

                <line x1="250" y1="110" x2="470" y2="110" class="bar"/>
                <line x1="250" y1="210" x2="470" y2="210" class="bar"/>

                <line x1="250" y1="80" x2="250" y2="240" class="M"/>
                <line x1="470" y1="80" x2="470" y2="240" class="M"/>
                <text x="256" y="70" class="T" opacity="${state.showMeasure?1:0}">–æ–¥–∏–Ω–∞–∫–æ–≤–æ</text>
              </svg>
            </div>

            ${controlsHTML(state)}
          </div>
        `
      },

      {
        id:'ebbinghaus',
        title:'–ò–ª–ª—é–∑–∏—è –≠–±–±–∏–Ω–≥–∞—É–∑–∞',
        type:'choice',
        badge:'–†–∞–∑–º–µ—Ä',
        question:'–ö–∞–∫–æ–π —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫—Ä—É–≥ –±–æ–ª—å—à–µ?',
        options:[
          {key:'left', label:'–õ–µ–≤—ã–π'},
          {key:'right', label:'–ü—Ä–∞–≤—ã–π'},
          {key:'equal', label:'–û–Ω–∏ —Ä–∞–≤–Ω—ã'}
        ],
        correct:'equal',
        explain:`–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ –∫—Ä—É–≥–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ, –Ω–æ –æ–∫—Ä—É–∂–µ–Ω–∏–µ ¬´—Å–¥–≤–∏–≥–∞–µ—Ç¬ª –æ—Ü–µ–Ω–∫—É —Ä–∞–∑–º–µ—Ä–∞:
—Ä—è–¥–æ–º —Å –±–æ–ª—å—à–∏–º–∏ –∫—Ä—É–≥–∞–º–∏ —Ü–µ–Ω—Ç—Ä –∫–∞–∂–µ—Ç—Å—è –º–µ–Ω—å—à–µ, –∞ —Ä—è–¥–æ–º —Å –º–∞–ª–µ–Ω—å–∫–∏–º–∏ ‚Äî –±–æ–ª—å—à–µ.`,
        render: (state) => `
          <div class="stageInner">
            <div class="svgWrap">
              <svg viewBox="0 0 760 300" role="img" aria-label="–ò–ª–ª—é–∑–∏—è –≠–±–±–∏–Ω–≥–∞—É–∑–∞">
                <defs>
                  <style>
                    .s{fill: rgba(148,163,184,.65)}
                    .b{fill: rgba(148,163,184,.45)}
                    .c{fill: rgba(229,231,235,.92)}
                    .M{stroke: rgba(96,165,250,.95); stroke-width:3; fill:none; opacity:${state.showMeasure?1:0}}
                    .T{fill: rgba(148,163,184,.8); font: 16px ${getComputedStyle(document.documentElement).getPropertyValue('--mono')}
                  </style>
                </defs>

                <!-- left group: big surrounding circles -->
                <g transform="translate(190,150)">
                  <circle r="32" class="c"/>
                  <g>
                    ${[0,60,120,180,240,300].map(a=>{
                      const rad = 78;
                      const x = Math.cos(a*Math.PI/180)*rad;
                      const y = Math.sin(a*Math.PI/180)*rad;
                      return `<circle cx="${x}" cy="${y}" r="30" class="b"/>`;
                    }).join('')}
                  </g>
                  <circle r="32" class="M"/>
                </g>

                <!-- right group: small surrounding circles -->
                <g transform="translate(570,150)">
                  <circle r="32" class="c"/>
                  <g>
                    ${[0,60,120,180,240,300].map(a=>{
                      const rad = 78;
                      const x = Math.cos(a*Math.PI/180)*rad;
                      const y = Math.sin(a*Math.PI/180)*rad;
                      return `<circle cx="${x}" cy="${y}" r="14" class="s"/>`;
                    }).join('')}
                  </g>
                  <circle r="32" class="M"/>
                </g>

                <text x="20" y="26" class="T" opacity="${state.showMeasure?1:0}">–º–µ—Ä–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: —Ü–µ–Ω—Ç—Ä—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ</text>
              </svg>
            </div>

            ${controlsHTML(state)}
          </div>
        `
      },

      {
        id:'zollner',
        title:'–ò–ª–ª—é–∑–∏—è –¶—ë–ª–ª—å–Ω–µ—Ä–∞',
        type:'choice',
        badge:'–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å',
        question:'–î–ª–∏–Ω–Ω—ã–µ –ª–∏–Ω–∏–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã?',
        options:[
          {key:'yes', label:'–î–∞, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã'},
          {key:'no', label:'–ù–µ—Ç, –Ω–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã'}
        ],
        correct:'yes',
        explain:`–ö–æ—Ä–æ—Ç–∫–∏–µ –Ω–∞–∫–ª–æ–Ω–Ω—ã–µ —à—Ç—Ä–∏—Ö–∏ –∑–∞—Å—Ç–∞–≤–ª—è—é—Ç –º–æ–∑–≥ ¬´—Å—á–∏—Ç–∞—Ç—å¬ª, —á—Ç–æ –¥–ª–∏–Ω–Ω—ã–µ –ª–∏–Ω–∏–∏ —Ä–∞—Å—Ö–æ–¥—è—Ç—Å—è.
–ù–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –æ–Ω–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã.`,
        render: (state) => `
          <div class="stageInner">
            <div class="svgWrap">
              <svg viewBox="0 0 760 300" role="img" aria-label="–ò–ª–ª—é–∑–∏—è –¶—ë–ª–ª—å–Ω–µ—Ä–∞">
                <defs>
                  <style>
                    .L{stroke: rgba(229,231,235,.92); stroke-width:10; stroke-linecap:round}
                    .S{stroke: rgba(148,163,184,.7); stroke-width:6; stroke-linecap:round}
                    .M{stroke: rgba(96,165,250,.95); stroke-width:3; opacity:${state.showMeasure?1:0}}
                    .T{fill: rgba(148,163,184,.8); font: 16px ${getComputedStyle(document.documentElement).getPropertyValue('--mono')}
                  </style>
                </defs>

                <!-- long lines -->
                <line x1="140" y1="90" x2="620" y2="90" class="L"/>
                <line x1="140" y1="210" x2="620" y2="210" class="L"/>

                <!-- short slanted strokes -->
                ${Array.from({length:9}).map((_,i)=>{
                  const x = 170 + i*55;
                  const y1 = 90;
                  const y2 = 210;
                  const dir = i%2===0 ? 1 : -1;
                  return `
                    <line x1="${x-20}" y1="${y1-28*dir}" x2="${x+20}" y2="${y1+28*dir}" class="S"/>
                    <line x1="${x-20}" y1="${y2-28*dir}" x2="${x+20}" y2="${y2+28*dir}" class="S"/>
                  `;
                }).join('')}

                <!-- measurement guide -->
                <line x1="120" y1="90" x2="640" y2="90" class="M"/>
                <line x1="120" y1="210" x2="640" y2="210" class="M"/>
                <text x="20" y="26" class="T" opacity="${state.showMeasure?1:0}">–º–µ—Ä–∫–∏: –ª–∏–Ω–∏–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã</text>
              </svg>
            </div>

            ${controlsHTML(state)}
          </div>
        `
      },

      {
        id:'hering',
        title:'–ò–ª–ª—é–∑–∏—è –ì–µ—Ä–∏–Ω–≥–∞',
        type:'choice',
        badge:'–ö—Ä–∏–≤–∏–∑–Ω–∞',
        question:'–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ –ø—Ä—è–º—ã–µ?',
        options:[
          {key:'yes', label:'–î–∞, –ø—Ä—è–º—ã–µ'},
          {key:'no', label:'–ù–µ—Ç, –∏–∑–æ–≥–Ω—É—Ç—ã'}
        ],
        correct:'yes',
        explain:`–†–∞–¥–∏–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ –¥–∞—é—Ç –æ—â—É—â–µ–Ω–∏–µ ¬´–≤—ã–ø—É–∫–ª–æ—Å—Ç–∏¬ª –∏–ª–∏ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã, –ø–æ—ç—Ç–æ–º—É –ø—Ä—è–º—ã–µ –∫–∞–∂—É—Ç—Å—è –∏–∑–æ–≥–Ω—É—Ç—ã–º–∏.
–ï—Å–ª–∏ –≤–∫–ª—é—á–∏—Ç—å –º–µ—Ä–∫–∏, –≤–∏–¥–Ω–æ: –æ–Ω–∏ —Å—Ç—Ä–æ–≥–æ –ø—Ä—è–º—ã–µ.`,
        render: (state) => {
          const rays = Array.from({length:32}).map((_,i)=>{
            const a = (i/32) * Math.PI - Math.PI/2;
            const x = 380 + Math.cos(a)*420;
            const y = 150 + Math.sin(a)*420;
            return `<line x1="380" y1="150" x2="${x.toFixed(1)}" y2="${y.toFixed(1)}" stroke="rgba(148,163,184,.45)" stroke-width="4"/>`;
          }).join('');
          return `
            <div class="stageInner">
              <div class="svgWrap">
                <svg viewBox="0 0 760 300" role="img" aria-label="–ò–ª–ª—é–∑–∏—è –ì–µ—Ä–∏–Ω–≥–∞">
                  <defs>
                    <style>
                      .V{stroke: rgba(229,231,235,.92); stroke-width:10; stroke-linecap:round}
                      .M{stroke: rgba(96,165,250,.95); stroke-width:3; opacity:${state.showMeasure?1:0}}
                      .T{fill: rgba(148,163,184,.8); font: 16px ${getComputedStyle(document.documentElement).getPropertyValue('--mono')}
                    </style>
                  </defs>
                  ${rays}
                  <line x1="280" y1="30" x2="280" y2="270" class="V"/>
                  <line x1="480" y1="30" x2="480" y2="270" class="V"/>

                  <line x1="280" y1="20" x2="280" y2="280" class="M"/>
                  <line x1="480" y1="20" x2="480" y2="280" class="M"/>
                  <text x="20" y="26" class="T" opacity="${state.showMeasure?1:0}">–º–µ—Ä–∫–∏: –ø—Ä—è–º—ã–µ</text>
                </svg>
              </div>

              ${controlsHTML(state)}
            </div>
          `;
        }
      },

      {

        id:'oppel-kundt',
        title:'–ò–ª–ª—é–∑–∏—è –û–ø–ø–µ–ª—å‚Äë–ö—É–Ω–¥—Ç–∞',
        type:'choice',
        badge:'–î–µ–ª–µ–Ω–∏–µ',
        question:'–ö–∞–∫–æ–π –æ—Ç—Ä–µ–∑–æ–∫ –∫–∞–∂–µ—Ç—Å—è –¥–ª–∏–Ω–Ω–µ–µ?',
        options:[
          {key:'left', label:'–õ–µ–≤—ã–π'},
          {key:'right', label:'–ü—Ä–∞–≤—ã–π'},
          {key:'equal', label:'–û–Ω–∏ —Ä–∞–≤–Ω—ã'}
        ],
        correct:'equal',
        explain:`–î–≤–∞ –æ—Ç—Ä–µ–∑–∫–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–æ –¥–ª–∏–Ω–µ, –Ω–æ –µ—Å–ª–∏ –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö ¬´—Ä–∞–∑–¥–µ–ª–∏—Ç—å¬ª —á–∞—Å—Ç—ã–º–∏ —à—Ç—Ä–∏—Ö–∞–º–∏,
–æ–Ω —á–∞—Å—Ç–æ –∫–∞–∂–µ—Ç—Å—è –¥–ª–∏–Ω–Ω–µ–µ. –ú–æ–∑–≥ —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –¥–µ—Ç–∞–ª–µ–π –∏ –æ—à–∏–±–∞–µ—Ç—Å—è –≤ –æ—Ü–µ–Ω–∫–µ –¥–ª–∏–Ω—ã.`,
        render: (state) => `
          <div class="stageInner">
            <div class="svgWrap">
              <svg viewBox="0 0 760 260" role="img" aria-label="–ò–ª–ª—é–∑–∏—è –û–ø–ø–µ–ª—å‚Äë–ö—É–Ω–¥—Ç–∞">
                <defs>
                  <style>
                    .L{stroke: rgba(229,231,235,.92); stroke-width:14; stroke-linecap:round}
                    .tick{stroke: rgba(148,163,184,.8); stroke-width:6; stroke-linecap:round}
                    .M{stroke: rgba(96,165,250,.95); stroke-width:3; opacity:${state.showMeasure?1:0}}
                    .T{fill: rgba(148,163,184,.8); font: 16px ${getComputedStyle(document.documentElement).getPropertyValue('--mono')}
                  </style>
                </defs>

                <!-- left segmented -->
                <line x1="140" y1="120" x2="340" y2="120" class="L"/>
                ${Array.from({length:9}).map((_,i)=>{
                  const x = 160 + i*20;
                  return `<line x1="${x}" y1="96" x2="${x}" y2="144" class="tick"/>`;
                }).join('')}

                <!-- right plain -->
                <line x1="420" y1="120" x2="620" y2="120" class="L"/>

                <!-- measurement guides -->
                <line x1="140" y1="60" x2="140" y2="190" class="M"/>
                <line x1="340" y1="60" x2="340" y2="190" class="M"/>
                <line x1="420" y1="60" x2="420" y2="190" class="M"/>
                <line x1="620" y1="60" x2="620" y2="190" class="M"/>
                <text x="22" y="28" class="T" opacity="${state.showMeasure?1:0}">–º–µ—Ä–∫–∏: —Ä–∞–≤–Ω—ã</text>
              </svg>
            </div>

            ${controlsHTML(state)}
          </div>
        `
      }
    ];

    function controlsHTML(state){
      const opts = state.test.options.map(o => `
        <button class="btn ${state.answered? 'secondary':''}" data-answer="${o.key}">
          ${o.label}
        </button>
      `).join('');

      return `
        <div class="controls">
          <div class="answers">${opts}</div>
          <label class="toggle">
            <input type="checkbox" ${state.showMeasure?'checked':''} data-toggle="measure"/>
            –ø–æ–∫–∞–∑–∞—Ç—å –º–µ—Ä–∫–∏
          </label>
        </div>
        <div class="feedback ${state.answered?'show':''}">
          <div class="line">
            <span class="pill ${state.isCorrect?'good':'bad'}">
              ${state.answered ? (state.isCorrect ? '‚úÖ –í–µ—Ä–Ω–æ' : '‚ùå –û–±–º–∞–Ω—É–ª–æ') : ''}
            </span>
            <span class="pill">–ø—Ä–∞–≤–∏–ª—å–Ω–æ: ${labelFor(state.test, state.test.correct)}</span>
          </div>
          <p class="explain">${escapeHTML(state.test.explain)}</p>
        </div>
      `;
    }

    function labelFor(test, key){
      const found = (test.options || []).find(o => o.key === key);
      if(found) return found.label;
      if(key === 'yes') return '–î–∞';
      if(key === 'no') return '–ù–µ—Ç';
      return key;
    }

    function escapeHTML(s){
      return String(s).replace(/[&<>"']/g, m => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'
      }[m]));
    }

    // ---------- state ----------
    let current = 0;
    const defaultProgress = tests.reduce((acc,t)=> (acc[t.id]={answered:false, answer:null, showMeasure:false}, acc), {});
    let progress = loadProgress();
    let lastReportText = '';

    function loadProgress(){
      try{
        const raw = localStorage.getItem('visionQuizProgress');
        if(!raw) return structuredClone(defaultProgress);
        const p = JSON.parse(raw);
        return {...structuredClone(defaultProgress), ...p};
      }catch{
        return structuredClone(defaultProgress);
      }
    }
    function saveProgress(){
      localStorage.setItem('visionQuizProgress', JSON.stringify(progress));
      updateTopStats();
    }

    function resetProgress(){
      progress = structuredClone(defaultProgress);
      current = 0;
      saveProgress();
      updateUI();
      toast('–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω');
    }

    // ---------- rendering ----------
    const host = $('#testHost');

    function getStateFor(i){
      const test = tests[i];
      const p = progress[test.id] || {answered:false, answer:null, showMeasure:false};
      const isCorrect = p.answered ? (p.answer === test.correct) : false;
      return {test, ...p, isCorrect};
    }

    function renderTest(i){
      i = clamp(i, 0, tests.length-1);
      current = i;

      const st = getStateFor(i);
      const html = `
        <div class="testHeader" style="margin:0 0 6px">
          <div>
            <div class="row" style="gap:8px">
              <span class="badge">${st.test.badge}</span>
              <strong style="font-size:16px">${escapeHTML(st.test.title)}</strong>
            </div>
            <div class="question">${escapeHTML(st.test.question)}</div>
          </div>
        </div>
        ${st.test.render(st)}
      `;

      host.innerHTML = html;

      // answer buttons
      $$('[data-answer]', host).forEach(btn=>{
        btn.addEventListener('click', ()=>{
          if(progress[st.test.id].answered) return;
          const ans = btn.dataset.answer;
          progress[st.test.id].answered = true;
          progress[st.test.id].answer = ans;
          saveProgress();
          renderTest(current);

          if(demoMode){
            setTimeout(()=>{ 
              if(current < tests.length-1) { current++; renderTest(current); updateUI(); } 
              else { routeTo('results'); } 
            }, 350);
          }
        });
      });

      // measure toggle
      const tog = $('[data-toggle="measure"]', host);
      if(tog){
        tog.addEventListener('change', ()=>{
          progress[st.test.id].showMeasure = tog.checked;
          saveProgress();
          renderTest(current);
        });
      }

      updateUI();
    }

    function updateUI(){
      $('#qBadge').textContent = `–í–æ–ø—Ä–æ—Å ${current+1}/${tests.length}`;
      $('#answeredTotal').textContent = tests.length;
      $('#progTotal').textContent = tests.length;

      const answered = tests.filter(t => progress[t.id]?.answered).length;
      $('#answeredCount').textContent = answered;
      $('#progCount').textContent = answered;

      const pct = Math.round((answered/tests.length)*100);
      $('#barFill').style.width = `${pct}%`;

      $('#prevBtn').disabled = current === 0;
      const isLastQuestion = current === tests.length - 1;
      $('#nextBtn').disabled = false;
      $('#nextBtn').textContent = isLastQuestion ? '–ó–∞–≤–µ—Ä—à–∏—Ç—å' : '–î–∞–ª—å—à–µ ‚Üí';
      $('#nextBtn').setAttribute('aria-label', isLastQuestion ? '–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç –∏ –æ—Ç–∫—Ä—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã' : '–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É');

      $('#totalCount').textContent = tests.length;

      if(!views.results.hidden) renderResults();
    }

    function renderResults(){
      const answered = tests.filter(t => progress[t.id]?.answered).length;
      const correct = tests.filter(t => progress[t.id]?.answered && progress[t.id].answer === t.correct).length;
      const fooled = answered - correct;
      const accuracy = answered ? Math.round((correct / answered) * 100) : 0;

      const byType = {
        length: ['muller-lyer','ponzo','oppel-kundt'],
        size: ['ebbinghaus'],
        parallel: ['zollner'],
        curve: ['hering']
      };

      const segment = (ids) => {
        const items = ids.map(id => progress[id]).filter(Boolean);
        const a = items.filter(x => x.answered).length;
        const c = ids.filter(id => progress[id]?.answered && progress[id]?.answer === tests.find(t=>t.id===id).correct).length;
        return {answered:a, correct:c, fooled: a-c};
      };

      const segLength = segment(byType.length);
      const segSize = segment(byType.size);
      const segOther = {
        answered: segment(byType.parallel).answered + segment(byType.curve).answered,
        fooled: segment(byType.parallel).fooled + segment(byType.curve).fooled
      };
      const segLengthRate = segLength.answered ? Math.round(((segLength.answered - segLength.fooled) / segLength.answered) * 100) : 0;
      const segSizeRate = segSize.answered ? Math.round(((segSize.answered - segSize.fooled) / segSize.answered) * 100) : 0;
      const segOtherRate = segOther.answered ? Math.round(((segOther.answered - segOther.fooled) / segOther.answered) * 100) : 0;

      const verdict = (() => {
        if(answered === 0) return '–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤ ‚Äî –ø—Ä–æ–π–¥–∏ —Ç–µ—Å—Ç üôÇ';
        const rate = correct/answered;
        if(rate >= .84) return '–û—á–µ–Ω—å –≤–Ω–∏–º–∞—Ç–µ–ª–µ–Ω: –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–µ–±—è –Ω–µ —Ç–∞–∫ –ª–µ–≥–∫–æ –æ–±–º–∞–Ω–µ—Ç.';
        if(rate >= .6) return '–ù–µ–ø–ª–æ—Ö–æ! –ò–Ω–æ–≥–¥–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—Å—ë –∂–µ –ø–æ–±–µ–∂–¥–∞–µ—Ç.';
        if(rate >= .4) return '–ù–æ—Ä–º–∞–ª—å–Ω–æ: –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ª—é–¥–µ–π –æ—à–∏–±–∞–µ—Ç—Å—è –Ω–∞ —Ç–∞–∫–∏—Ö –∫–∞—Ä—Ç–∏–Ω–∫–∞—Ö.';
        return '–°–µ–≥–æ–¥–Ω—è –º–æ–∑–≥ —Ä–µ—à–∏–ª ¬´–¥–æ–¥—É–º–∞—Ç—å¬ª –∫–∞—Ä—Ç–∏–Ω–∫—É –∑–∞ —Ç–µ–±—è ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å –∏–ª–ª—é–∑–∏–∏ üôÇ';
      })();

      const grid = $('#resultGrid');
      grid.innerHTML = `
        <div class="metric resultSummary">
          <div class="resultMain">
            <h4>–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞</h4>
            <p>
              –û—Ç–≤–µ—á–µ–Ω–æ: <b>${answered}</b> –∏–∑ <b>${tests.length}</b><br/>
              –í–µ—Ä–Ω–æ: <b>${correct}</b>, ¬´–æ–±–º–∞–Ω—É–ª–æ¬ª: <b>${fooled}</b><br/>
              <span class="muted">–í—ã–≤–æ–¥:</span> ${escapeHTML(verdict)}
            </p>
            <div class="resultHint">–¢–æ—á–Ω–æ—Å—Ç—å —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ —Ç–µ–º –≤–æ–ø—Ä–æ—Å–∞–º, –≥–¥–µ —É–∂–µ –µ—Å—Ç—å –æ—Ç–≤–µ—Ç.</div>
          </div>
          <div class="scoreRing" title="–¢–æ—á–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤">
            <span>${accuracy}%</span>
          </div>
        </div>
        <div class="metric">
          <h4>–ü–æ —Ç–∏–ø–∞–º —ç—Ñ—Ñ–µ–∫—Ç–æ–≤</h4>
          <ul class="resultList">
            <li class="resultLine">
              <span>–î–ª–∏–Ω–∞ –∏ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞</span>
              <b>${segLength.fooled}/${segLength.answered} –æ—à–∏–±–æ–∫ ‚Ä¢ ${segLengthRate}%</b>
            </li>
            <li class="resultLine">
              <span>–†–∞–∑–º–µ—Ä –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ</span>
              <b>${segSize.fooled}/${segSize.answered} –æ—à–∏–±–æ–∫ ‚Ä¢ ${segSizeRate}%</b>
            </li>
            <li class="resultLine">
              <span>–ì–µ–æ–º–µ—Ç—Ä–∏—è –ª–∏–Ω–∏–π</span>
              <b>${segOther.fooled}/${segOther.answered} –æ—à–∏–±–æ–∫ ‚Ä¢ ${segOtherRate}%</b>
            </li>
          </ul>
        </div>
        <div class="metric">
          <h4>–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç</h4>
          <p>
            –ï—Å–ª–∏ –æ—à–∏–±–æ–∫ –±–æ–ª—å—à–µ –≤ ¬´–¥–ª–∏–Ω–µ/–ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–µ¬ª, –º–æ–∑–≥ —Å–∏–ª—å–Ω–µ–µ –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –≥–ª—É–±–∏–Ω—É —Å—Ü–µ–Ω—ã.<br/>
            –ï—Å–ª–∏ —á–∞—â–µ –æ—à–∏–±–∞–µ—à—å—Å—è –≤ ¬´—Ä–∞–∑–º–µ—Ä–µ/–æ–∫—Ä—É–∂–µ–Ω–∏–∏¬ª, –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å–µ–¥–Ω–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≤–ª–∏—è–µ—Ç —Å–∏–ª—å–Ω–µ–µ.<br/>
            –ë–ª–æ–∫ ¬´–≥–µ–æ–º–µ—Ç—Ä–∏—è –ª–∏–Ω–∏–π¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é —à—Ç—Ä–∏—Ö–æ–≤ –∏ —Ä–∞–¥–∏–∞–ª—å–Ω–æ–º—É —Ñ–æ–Ω—É.
          </p>
        </div>
        <div class="metric">
          <h4>–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º</h4>
          <ul class="resultList">
            ${tests.map(t=>{
              const p = progress[t.id];
              const ok = p?.answered ? (p.answer === t.correct) : null;
              const mark = ok===null ? '‚Äî –±–µ–∑ –æ—Ç–≤–µ—Ç–∞' : (ok ? '‚úÖ –≤–µ—Ä–Ω–æ' : '‚ùå –æ—à–∏–±–∫–∞');
              const ans = p?.answered ? labelFor(t, p.answer) : '–Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞';
              return `
                <li class="resultLine">
                  <span>${escapeHTML(t.title)}: ${escapeHTML(ans)}</span>
                  <b>${mark}</b>
                </li>
              `;
            }).join('')}
          </ul>
        </div>
      `;

      const generatedAt = new Date().toLocaleString('ru-RU', { dateStyle: 'short', timeStyle: 'short' });
      lastReportText = [
        '–ö–∞–∫ —Ç—ã –≤–∏–¥–∏—à—å –º–∏—Ä ‚Äî –∏—Ç–æ–≥',
        `–î–∞—Ç–∞: ${generatedAt}`,
        `–û—Ç–≤–µ—á–µ–Ω–æ: ${answered}/${tests.length}`,
        `–í–µ—Ä–Ω–æ: ${correct}`,
        `–û—à–∏–±–æ–∫ –∏–∑-–∑–∞ –∏–ª–ª—é–∑–∏–π: ${fooled}`,
        `–¢–æ—á–Ω–æ—Å—Ç—å: ${accuracy}%`,
        `–í—ã–≤–æ–¥: ${verdict}`,
        '',
        '–ü–æ —Ç–∏–ø–∞–º —ç—Ñ—Ñ–µ–∫—Ç–æ–≤:',
        `- –î–ª–∏–Ω–∞ –∏ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞: ${segLength.fooled}/${segLength.answered} –æ—à–∏–±–æ–∫ (${segLengthRate}%)`,
        `- –†–∞–∑–º–µ—Ä –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ: ${segSize.fooled}/${segSize.answered} –æ—à–∏–±–æ–∫ (${segSizeRate}%)`,
        `- –ì–µ–æ–º–µ—Ç—Ä–∏—è –ª–∏–Ω–∏–π: ${segOther.fooled}/${segOther.answered} –æ—à–∏–±–æ–∫ (${segOtherRate}%)`,
        '',
        '–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º:',
        ...tests.map((t, idx) => {
          const p = progress[t.id];
          const ans = p?.answered ? labelFor(t, p.answer) : '–Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞';
          const status = p?.answered ? (p.answer === t.correct ? '–≤–µ—Ä–Ω–æ' : '–æ—à–∏–±–∫–∞') : '–±–µ–∑ –æ—Ç–≤–µ—Ç–∞';
          return `${idx + 1}. ${t.title}: ${ans} (${status})`;
        })
      ].join('\n');
      $('#reportOut').textContent = lastReportText;
    }

    // ---------- confetti ----------
    function confetti(){
      const root = $('#confetti');
      root.innerHTML = '';
      const n = 70;
      for(let i=0;i<n;i++){
        const el = document.createElement('div');
        el.className = 'piece';
        el.style.left = (Math.random()*100) + 'vw';
        el.style.animationDuration = (1.2 + Math.random()*1.4) + 's';
        el.style.animationDelay = (Math.random()*0.2) + 's';
        el.style.transform = `translateY(-20px) rotate(${Math.random()*180}deg)`;
        el.style.background = `hsl(${Math.floor(Math.random()*360)}, 85%, 65%)`;
        el.style.width = (6 + Math.random()*8) + 'px';
        el.style.height = (10 + Math.random()*14) + 'px';
        root.appendChild(el);
      }
      root.classList.add('show');
      setTimeout(()=>root.classList.remove('show'), 1800);
    }

    // ---------- toast ----------
    let toastTimer = null;
    function toast(msg){
      let el = $('#toast');
      if(!el){
        el = document.createElement('div');
        el.id = 'toast';
        el.style.position = 'fixed';
        el.style.left = '50%';
        el.style.bottom = '18px';
        el.style.transform = 'translateX(-50%)';
        el.style.background = 'rgba(17,24,39,.92)';
        el.style.border = '1px solid rgba(148,163,184,.18)';
        el.style.borderRadius = '14px';
        el.style.padding = '10px 12px';
        el.style.boxShadow = '0 18px 45px rgba(0,0,0,.45)';
        el.style.color = 'rgba(229,231,235,.92)';
        el.style.fontSize = '12px';
        el.style.zIndex = 1000;
        el.style.maxWidth = '92vw';
        document.body.appendChild(el);
      }
      el.textContent = msg;
      el.style.opacity = '1';
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>{ el.style.opacity = '0'; }, 1300);
    }

    // ---------- UI wiring ----------
    $('#startBtn').addEventListener('click', ()=> routeTo('tests'));
    $('#resetBtn').addEventListener('click', resetProgress);
    $('#backToTestsBtn').addEventListener('click', ()=> routeTo('tests'));
    $('#prevBtn').addEventListener('click', ()=> { current = Math.max(0, current-1); renderTest(current); });
    $('#nextBtn').addEventListener('click', ()=> {
      if(current === tests.length - 1){
        routeTo('results');
        return;
      }
      current = Math.min(tests.length-1, current+1);
      renderTest(current);
    });
    $('#copyBtn').addEventListener('click', async ()=>{
      try{
        const report = lastReportText || $('#reportOut').textContent || '–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—á—ë—Ç–∞.';
        await navigator.clipboard.writeText(report);
        toast('–û—Ç—á—ë—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω ‚úÖ');
      }catch{
        toast('–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –°–∫–æ–ø–∏—Ä—É–π —Ç–µ–∫—Å—Ç –∏–∑ –±–ª–æ–∫–∞ –Ω–∏–∂–µ.');
      }
    });

    chips.forEach(ch => ch.addEventListener('click', ()=> routeTo(ch.dataset.route)));

    // demo mode: auto answers randomly
    let demoMode = false;
    $('#demoBtn').addEventListener('click', ()=>{
      demoMode = !demoMode;
      toast(demoMode ? '–î–µ–º–æ‚Äë—Ä–µ–∂–∏–º: –í–ö–õ' : '–î–µ–º–æ‚Äë—Ä–µ–∂–∏–º: –í–´–ö–õ');
      if(demoMode){
        routeTo('tests');
        setTimeout(()=>demoTick(), 200);
      }
    });

    function demoTick(){
      if(!demoMode) return;
      const t = tests[current];
      const p = progress[t.id];
      if(!p.answered){
        const randomOpt = t.options[Math.floor(Math.random()*t.options.length)].key;
        progress[t.id].answered = true;
        progress[t.id].answer = randomOpt;
        saveProgress();
        renderTest(current);
      }
      if(current < tests.length-1){
        current++;
        setTimeout(()=>{ renderTest(current); demoTick(); }, 180);
      }else{
        demoMode = false;
        routeTo('results');
      }
    }

    // ----------- top stats ----------
    function updateTopStats(){
      const answered = tests.filter(t => progress[t.id]?.answered).length;
      $('#progCount').textContent = answered;
      $('#progTotal').textContent = tests.length;
      $('#answeredCount').textContent = answered;
      $('#answeredTotal').textContent = tests.length;
    }

    // ----------- init ----------
    (function init(){
      const savedRoute = localStorage.getItem('route') || 'home';
      routeTo(savedRoute in views ? savedRoute : 'home');

      const answered = tests.filter(t => progress[t.id]?.answered).length;
      const correct = tests.filter(t => progress[t.id]?.answered && progress[t.id].answer === t.correct).length;
      if(answered === tests.length && correct === answered && !sessionStorage.getItem('confettiShown')){
        confetti();
        sessionStorage.setItem('confettiShown', '1');
      }

      updateUI();

      window.addEventListener('keydown', (e)=>{
        if(e.key === 'Escape') routeTo('home');
        if(views.tests.hidden) return;
        if(e.key === 'ArrowLeft') $('#prevBtn').click();
        if(e.key === 'ArrowRight') $('#nextBtn').click();
      });
    })();

    // show confetti when finishing perfectly
    const observer = new MutationObserver(()=>{
      const answered = tests.filter(t => progress[t.id]?.answered).length;
      const correct = tests.filter(t => progress[t.id]?.answered && progress[t.id].answer === t.correct).length;
      if(answered === tests.length && correct === answered){
        confetti();
      }
    });
    observer.observe(document.body, {subtree:true, childList:true, characterData:true});
  </script>
</body>
</html>
